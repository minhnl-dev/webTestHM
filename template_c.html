<!-- Site A: index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Site A</title>
</head>
<body>
<div id="mieruca_optimize_editor_change_images" class="mieruca-optimize-editor">
  <div class="mieruca-optimize-heading">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
          d="M14.5 2.22266H1.5C1.10218 2.22266 0.720644 2.38069 0.43934 2.662C0.158035 2.9433 0 3.32483 0 3.72266L0 12.7227C0 13.1205 0.158035 13.502 0.43934 13.7833C0.720644 14.0646 1.10218 14.2227 1.5 14.2227H14.5C14.8978 14.2227 15.2794 14.0646 15.5607 13.7833C15.842 13.502 16 13.1205 16 12.7227V3.72266C16 3.32483 15.842 2.9433 15.5607 2.662C15.2794 2.38069 14.8978 2.22266 14.5 2.22266ZM14.3111 12.7227H1.68889C1.63915 12.7227 1.59144 12.7029 1.55627 12.6677C1.52109 12.6325 1.50133 12.5848 1.50133 12.5351V3.91155C1.50133 3.8618 1.52109 3.8141 1.55627 3.77892C1.59144 3.74375 1.63915 3.72399 1.68889 3.72399H14.3111C14.3609 3.72399 14.4086 3.74375 14.4437 3.77892C14.4789 3.8141 14.4987 3.8618 14.4987 3.91155V12.5338C14.4988 12.5585 14.4941 12.583 14.4848 12.606C14.4754 12.6289 14.4616 12.6497 14.4442 12.6673C14.4268 12.6848 14.406 12.6987 14.3832 12.7083C14.3604 12.7178 14.3359 12.7227 14.3111 12.7227ZM4 4.97288C3.75271 4.97288 3.51098 5.04621 3.30537 5.18361C3.09976 5.32101 2.93952 5.51629 2.8449 5.74476C2.75029 5.97324 2.72556 6.22464 2.77383 6.46717C2.82211 6.7097 2.94123 6.93247 3.11612 7.1073C3.29101 7.28213 3.51382 7.40116 3.75637 7.44935C3.99891 7.49754 4.25031 7.47272 4.47875 7.37803C4.70719 7.28333 4.90241 7.12302 5.03974 6.91737C5.17706 6.71171 5.25031 6.46995 5.25022 6.22266C5.2501 5.89115 5.11833 5.57327 4.88388 5.3389C4.64943 5.10454 4.3315 4.97288 4 4.97288ZM3 11.2227H13V8.72266L10.2667 5.98799C10.1963 5.91772 10.101 5.87826 10.0016 5.87826C9.90213 5.87826 9.80678 5.91772 9.73644 5.98799L6.00311 9.72132L4.76533 8.48932C4.695 8.41906 4.59964 8.37959 4.50022 8.37959C4.4008 8.37959 4.30545 8.41906 4.23511 8.48932L3 9.72266V11.2227Z"
          fill="#667075" />
    </svg>
    画像を変更
  </div>
  <div class="mieruca-optimize-content">
    <div class="mieruca-optimize-image-input-link">
      <p>画像リンク</p>
      <input id="mieruca_optimize_image_link" type="text"
             value="http://localhost/resources/images/home/problem/problem_1.png">
    </div>
    <div class="mieruca-optimize-image-preview">
      <p>プレビュー</p>
      <div class="mieruca-optimize-image-preview-inner">
        <div class="mieruca-optimize-image-src">
          <img id="mieruca_optimize_image_link_src"
               src="http://localhost/resources/images/home/problem/problem_1.png" alt="">
        </div>
        <div class="mieruca-optimize-image-upload">
          <div class="fileinput-image"><input id="file_input_image" class="file-input-image" type="file"
                                              accept="image/gif, image/jpeg, image/png, image/jfif, image/jpg, image/webp"><span>画像をアップロード</span>
          </div>
          <div class="mieruca-optimize-attr">
            <div class="mieruca-optimize-attr-item">
              <p>width</p>
              <div class="mieruca-optimize-flex">
                <input type="text" id="mieruca_optimize_image_width">
                <select name="">
                  <option value="px">px</option>
                  <option value="em">em</option>
                </select>
              </div>
            </div>
            <div class="mieruca-optimize-attr-item">
              <p>height</p>
              <div class="mieruca-optimize-flex">
                <input type="text" id="mieruca_optimize_image_height">
                <select name="" id="">
                  <option value="px">px</option>
                  <option value="em">em</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mieruca-optimize-alt">
            <p>alt 属性</p>
            <input type="text" placeholder="alt属性名を入力" id="mieruca_optimize_image_alt">
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mieruca-optimize-footer">
    <button class="mieruca-optimize-btn-save">Save</button>
  </div>
</div>

<script>
  const handleClickShowModalEditor = () => {
    document.getElementById('mieruca_optimize_image_link').value = 'https://upload-opt.mieru-ca.com/useruploads-dev/39101/images/d41ac1776452d257997cf4e2c871bc1d_448769165_850357163658461_2920403311067058175_n.jpg';
    document.getElementById('mieruca_optimize_image_link_src').src = 'https://upload-opt.mieru-ca.com/useruploads-dev/39101/images/d41ac1776452d257997cf4e2c871bc1d_448769165_850357163658461_2920403311067058175_n.jpg';
    let img = new Image();
    document.getElementById('mieruca_optimize_image_alt').value = "This is image";
    img.onload = function() {
      var width = img.width;
      var height = img.height;
      document.getElementById('mieruca_optimize_image_width').value = width;
      document.getElementById('mieruca_optimize_image_height').value = height;
    };
    img.src = 'https://upload-opt.mieru-ca.com/useruploads-dev/39101/images/d41ac1776452d257997cf4e2c871bc1d_448769165_850357163658461_2920403311067058175_n.jpg';
    handleUploadImage();
  }
  const handleUploadImage = () => {
    let uploadImage = document.getElementById('file_input_image');
    uploadImage.addEventListener('change', (event) => {
      var file = event.target.files[0];
      if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
          const arrayBuffer = event.target.result;
          const message = {
            action: 'IMAGE_UPLOAD',
            data: {
              type: 'fileUpload',
              file: arrayBuffer,
              fileName: file.name,
              fileType: file.type
            }
          };
          opener.postMessage(message, 'https://app.mieru-ca.com');
          var img = new Image();
          img.onload = function() {
            var width = img.width;
            var height = img.height;
            $('#mieruca_optimize_image_width').val(width);
            $('#mieruca_optimize_image_height').val(height);
          };
        };
        reader.readAsDataURL(file);
      }
    });

    window.addEventListener('message', (event) => {
      if (event.origin !== 'https://app.mieru-ca.com') return;

      $('#mieruca_optimize_image_link').val(event.data.imageSrc);
      $('#mieruca_optimize_image_link_src').attr('src', event.data.imageSrc);
      $('#mieruca_optimize_image_alt').val(event.data.imageName);
    });
  };
  handleClickShowModalEditor();
</script>
<style>
  .mieruca-optimize-image-input-link {
    margin-bottom: 8px;
  }

  .mieruca-optimize-image-input-link p {
    font-size: 12px;
    margin: 0;
    padding: 0;
    color: #191B1C;
    margin-bottom: 5px;
  }

  .mieruca-optimize-image-input-link input {
    background: #E9F1F5;
    color: #090A0A;
    font-size: 12px;
    border-radius: 4px;
    padding: 8px;
    outline: 0;
    width: 100%;
  }

  .mieruca-optimize-image-preview p {
    margin: 0;
    padding: 0;
    font-size: 12px;
    color: #191B1C;
    margin-bottom: 5px;
  }

  .mieruca-optimize-image-preview-inner {
    display: flex;
    gap: 20px;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-image-src {
    max-width: 234px;
  }

  .mieruca-optimize-image-preview-inner>div {
    width: 50%;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-image-src img {
    max-width: 100%;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-image-upload .fileinput-image {
    background: #FCD4BB;
    color: #4A4A4A;
    font-size: 12px;
    font-weight: 600;
    padding: 5px 16px;
    border-radius: 4px;
    display: inline-block;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-image-upload .fileinput-image input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
  }


  .mieruca-optimize-image-preview-inner .mieruca-optimize-attr {
    margin-top: 8px;
    display: flex;
    gap: 8px;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-attr-item input {
    background: #E9F1F5;
    height: 24px;
    width: 80px;
    padding: 0 8px;
    font-size: 12px;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-attr-item select {
    padding: 0;
    background: transparent;
    font-size: 12px;
    height: 24px;
    min-height: inherit;
    appearance: auto;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-alt {
    margin-top: 8px;
  }

  .mieruca-optimize-image-preview-inner .mieruca-optimize-alt input {
    background: #E9F1F5;
    height: 24px;
    width: 100%;
    padding: 0 8px;
    font-size: 12px;
  }

  .mieruca-optimize-flex {
    display: flex;
    align-items: center;
    gap: 5px;
  }
</style>
</body>
</html>
